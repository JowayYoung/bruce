import{readdirSync as st,readFileSync as ue,writeFileSync as fe}from"node:fs";import{basename as _,extname as pe}from"node:path";import{exit as s}from"node:process";import{AbsPath as S,CreateDir as ns}from"@yangzw/bruce-us/dist/node.js";import ko from"is-animated";import{lookup as xo}from"mime-types";import no from"ora";import{GENERATE_TEXT as yo}from"../langs/index.js";import{DATA_REGEXP as We,ShowTitle as io}from"../utils/index.js";export default function vo({alone:e=!0,input:o="",output:t=""}){e&&io("generate"),"#ENOENT"===o&&(console.log(yo.judgeExist),s(1));const r=S(t?`${t}/icons.css`:"icons.css"),n=st(S(o)).filter((e=>{const t=S(`${o}/${e}`);return We.img.test(pe(t))&&!ko(ue(t))}));if(n.length){const i=no(yo.doing).start(),s=n.reduce(((e,t)=>{const r=S(`${o}/${t}`),n=_(r).replace(/\.(.+?)$/,""),i=ue(r,"utf8"),s=Buffer.from(i).toString("base64"),a=`data:${xo(r).toString()};base64,${s}`,m=[...i.matchAll(We.color)].map((e=>e[0])),c=m.length?m[0]:"",p=m.every((e=>e===c))&&!i.includes("gradient");return e+(p?`.icon-${n}{background-color:currentColor;-webkit-mask-image:url("${a}");mask-image:url("${a}");-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-position:center;mask-position:center;-webkit-mask-size:cover;mask-size:cover;}`:`.icon-${n}{background-color:transparent;background-image:url("${a}");background-repeat:no-repeat;background-position:center;background-size:cover;}`)}),".icon{display:block;width:1em;height:1em;transition:all 300ms;}.icon.disabled{pointer-events:none;}");ns(t),fe(r,s,"utf-8"),i.stop(),e&&console.log(yo.done(r))}else console.log(yo.judgeEmpty);e&&s(1)}