var g=this&&this.__awaiter||function(o,t,e,n){return new(e||(e=Promise))((function(i,r){function s(o){try{u(n.next(o))}catch(o){r(o)}}function a(o){try{u(n.throw(o))}catch(o){r(o)}}function u(o){var t;o.done?i(o.value):(t=o.value,t instanceof e?t:new e((function(o){o(t)}))).then(s,a)}u((n=n.apply(o,t||[])).next())}))};import{createReadStream as yo,createWriteStream as wo,statSync as wt}from"fs";import{basename as w,join as ei}from"path";import{exit as o}from"process";import{AbsPath as $,AsyncTo as M,CheckPath as _e,CreateDir as rs,RandomId as bo,RemoveDir as eo,WaitFor as no}from"@yangzw/bruce-us/dist/node.js";import jo from"image-size";import oo from"ora";import{GROUP_TEXT as nr}from"../langs/index.js";import{OUTPUT_DIR as mi,FilterImg as ci,GetExt as ui,ShowTitle as so}from"../utils/index.js";const Po={gif:ei(mi.group,"gif"),jpg:ei(mi.group,"jpg"),png:ei(mi.group,"png"),svg:ei(mi.group,"svg"),webp:ei(mi.group,"webp")},Ro={format:_o,size:Co,volume:Do},zo={big:ei(mi.group,"big"),middle:ei(mi.group,"middle"),small:ei(mi.group,"small")};function So(o="",t=""){return g(this,void 0,void 0,(function*(){const e=new Promise((e=>{var n;const i=ei(t,w(o).toLowerCase()),r=$(i);if(rs(t),_e(i)){const t=w(r).split("."),i=null!==(n=t.pop())&&void 0!==n?n:"png",s=t.concat(bo(4),i).join("."),a=r.replace(w(r),s);yo(o).pipe(wo(a)),e(!0)}else yo(o).pipe(wo(r)),e(!1)})),[n,i]=yield M(e);return yield no(100),!n&&i}))}function _o(o=""){return g(this,void 0,void 0,(function*(){const t=ui(o),e=Po[t],n=yield So(o,e);return nr.result1(o,t,n)}))}function Co(o=""){return g(this,void 0,void 0,(function*(){const{height:t=0,width:e=0}=jo(o),n=ei(mi.group,`${e}x${t}`),i=yield So(o,n);return nr.result2(o,`${e}x${t}`,i)}))}function Do(o=""){return g(this,void 0,void 0,(function*(){const{size:t}=wt($(o)),e=t<10240?"small":t>=102400?"big":"middle",n=zo[e],i=yield So(o,n);return nr.result3(o,e,i)}))}export default function vo(t){return g(this,void 0,void 0,(function*(){so("group");const e=oo(nr.doing).start();eo(mi.group),rs(mi.group);const{count:n,imgs:i}=ci(),r="boolean"==typeof t.type?"format":t.type,s=[];for(const o of i){const t=yield Ro[r](o);s.push(t)}e.stop(),console.log(nr.stats(n)),s.length<=100&&s.forEach((o=>console.log(o))),console.log(nr.done),o(1)}))}