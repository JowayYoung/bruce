var x=this&&this.__awaiter||function(o,t,n,i){return new(n||(n=Promise))((function(r,e){function s(o){try{p(i.next(o))}catch(o){e(o)}}function u(o){try{p(i.throw(o))}catch(o){e(o)}}function p(o){var t;o.done?r(o.value):(t=o.value,t instanceof n?t:new n((function(o){o(t)}))).then(s,u)}p((i=i.apply(o,t||[])).next())}))};import{createReadStream as wo,createWriteStream as zo,statSync as Wt}from"fs";import{basename as _,join as ii}from"path";import{exit as o}from"process";import{AbsPath as S,AsyncTo as Y,CheckPath as $t,CreateDir as rs,RandomId as Po,RemoveDir as eo,WaitFor as _e}from"@yangzw/bruce-us/dist/node.js";import _o from"image-size";import no from"ora";import{GROUP_TEXT as Fe}from"../langs/index.js";import{OUTPUT_DIR as ai,FilterImg as pi,GetExt as ui,ShowTitle as io}from"../utils/index.js";const Co={gif:ii(ai.group,"gif"),jpg:ii(ai.group,"jpg"),png:ii(ai.group,"png"),svg:ii(ai.group,"svg"),webp:ii(ai.group,"webp")},Eo={format:qo,size:Ao,volume:Bo},Lo={big:ii(ai.group,"big"),middle:ii(ai.group,"middle"),small:ii(ai.group,"small")};function ko(o="",t=""){return x(this,void 0,void 0,(function*(){const n=new Promise((n=>{var i;const r=ii(t,_(o).toLowerCase()),e=S(r);if(rs(t),$t(r)){const t=_(e).split("."),r=null!==(i=t.pop())&&void 0!==i?i:"png",s=t.concat(Po(4),r).join("."),u=e.replace(_(e),s);wo(o).pipe(zo(u)),n(!0)}else wo(o).pipe(zo(e)),n(!1)})),[i,r]=yield Y(n);return yield _e(100),!i&&r}))}function qo(o=""){return x(this,void 0,void 0,(function*(){const t=ui(o),n=Co[t],i=yield ko(o,n);return Fe.result1(o,t,i)}))}function Ao(o=""){return x(this,void 0,void 0,(function*(){const{height:t=0,width:n=0}=_o(o),i=ii(ai.group,`${n}x${t}`),r=yield ko(o,i);return Fe.result2(o,`${n}x${t}`,r)}))}function Bo(o=""){return x(this,void 0,void 0,(function*(){const{size:t}=Wt(S(o)),n=t<10240?"small":t>=102400?"big":"middle",i=Lo[n],r=yield ko(o,i);return Fe.result3(o,n,r)}))}export default function yo(t){return x(this,void 0,void 0,(function*(){io("group");const n=no(Fe.doing).start();eo(ai.group),rs(ai.group);const{count:i,imgs:r}=pi(),e="boolean"==typeof t.type?"format":t.type,s=[];for(const o of r){const t=yield Eo[e](o);s.push(t)}n.stop(),console.log(Fe.stats(i)),s.length<=100&&s.forEach((o=>console.log(o))),console.log(Fe.done),o(1)}))}