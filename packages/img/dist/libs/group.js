var x=this&&this.__awaiter||function(o,t,n,i){return new(n||(n=Promise))((function(r,e){function s(o){try{p(i.next(o))}catch(o){e(o)}}function u(o){try{p(i.throw(o))}catch(o){e(o)}}function p(o){var t;o.done?r(o.value):(t=o.value,t instanceof n?t:new n((function(o){o(t)}))).then(s,u)}p((i=i.apply(o,t||[])).next())}))};import{createReadStream as To,createWriteStream as Uo,statSync as ut}from"node:fs";import{basename as _,join as qo}from"node:path";import{exit as s}from"node:process";import{AbsPath as S,AsyncTo as Y,CheckPath as Ke,CreateDir as ns,RandomId as Wo,RemoveDir as eo,WaitFor as to}from"@yangzw/bruce-us/dist/node.js";import Xo from"image-size";import no from"ora";import{GROUP_TEXT as o$}from"../langs/index.js";import{OUTPUT_DIR as Ao,FilterImg as Ho,GetExt as Ko,ShowTitle as io}from"../utils/index.js";const Yo={gif:qo(Ao.group,"gif"),jpg:qo(Ao.group,"jpg"),png:qo(Ao.group,"png"),svg:qo(Ao.group,"svg"),webp:qo(Ao.group,"webp")},Zo={format:bt,size:xt,volume:jt},gt={big:qo(Ao.group,"big"),middle:qo(Ao.group,"middle"),small:qo(Ao.group,"small")};function wt(){return x(this,arguments,void 0,(function*(o="",t=""){const n=new Promise((n=>{var i;const r=qo(t,_(o).toLowerCase()),e=S(r);if(ns(t),Ke(r)){const t=_(e).split("."),r=null!==(i=t.pop())&&void 0!==i?i:"png",s=t.concat(Wo(4),r).join("."),u=e.replace(_(e),s);To(o).pipe(Uo(u)),n(!0)}else To(o).pipe(Uo(e)),n(!1)})),[i,r]=yield Y(n);return yield to(100),!i&&r}))}function bt(){return x(this,arguments,void 0,(function*(o=""){const t=Ko(o),n=Yo[t],i=yield wt(o,n);return o$.result1(o,t,i)}))}function xt(){return x(this,arguments,void 0,(function*(o=""){const{height:t=0,width:n=0}=Xo(o),i=qo(Ao.group,`${n}x${t}`),r=yield wt(o,i);return o$.result2(o,`${n}x${t}`,r)}))}function jt(){return x(this,arguments,void 0,(function*(o=""){const{size:t}=ut(S(o)),n=t<10240?"small":t>=102400?"big":"middle",i=gt[n],r=yield wt(o,i);return o$.result3(o,n,r)}))}export default function No(o){return x(this,void 0,void 0,(function*(){io("group");const t=no(o$.doing).start();eo(Ao.group),ns(Ao.group);const{count:n,imgs:i}=Ho(),r="boolean"==typeof o.type?"format":o.type,e=[];for(const o of i){const t=yield Zo[r](o);e.push(t)}t.stop(),console.log(o$.stats(n)),e.length<=100&&e.forEach((o=>console.log(o))),console.log(o$.done),s(1)}))}