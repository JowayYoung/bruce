var x=this&&this.__awaiter||function(o,t,n,i){return new(n||(n=Promise))((function(r,e){function s(o){try{p(i.next(o))}catch(o){e(o)}}function u(o){try{p(i.throw(o))}catch(o){e(o)}}function p(o){var t;o.done?r(o.value):(t=o.value,t instanceof n?t:new n((function(o){o(t)}))).then(s,u)}p((i=i.apply(o,t||[])).next())}))};import{createReadStream as Po,createWriteStream as _o,statSync as Ft}from"fs";import{basename as _,join as ii}from"path";import{exit as o}from"process";import{AbsPath as S,AsyncTo as Y,CheckPath as He,CreateDir as rs,RandomId as Co,RemoveDir as eo,WaitFor as Ze}from"@yangzw/bruce-us/dist/node.js";import Eo from"image-size";import no from"ora";import{GROUP_TEXT as e$}from"../langs/index.js";import{OUTPUT_DIR as ai,FilterImg as pi,GetExt as ui,ShowTitle as io}from"../utils/index.js";const Lo={gif:ii(ai.group,"gif"),jpg:ii(ai.group,"jpg"),png:ii(ai.group,"png"),svg:ii(ai.group,"svg"),webp:ii(ai.group,"webp")},ko={format:Bo,size:Do,volume:Go},qo={big:ii(ai.group,"big"),middle:ii(ai.group,"middle"),small:ii(ai.group,"small")};function Ao(o="",t=""){return x(this,void 0,void 0,(function*(){const n=new Promise((n=>{var i;const r=ii(t,_(o).toLowerCase()),e=S(r);if(rs(t),He(r)){const t=_(e).split("."),r=null!==(i=t.pop())&&void 0!==i?i:"png",s=t.concat(Co(4),r).join("."),u=e.replace(_(e),s);Po(o).pipe(_o(u)),n(!0)}else Po(o).pipe(_o(e)),n(!1)})),[i,r]=yield Y(n);return yield Ze(100),!i&&r}))}function Bo(o=""){return x(this,void 0,void 0,(function*(){const t=ui(o),n=Lo[t],i=yield Ao(o,n);return e$.result1(o,t,i)}))}function Do(o=""){return x(this,void 0,void 0,(function*(){const{height:t=0,width:n=0}=Eo(o),i=ii(ai.group,`${n}x${t}`),r=yield Ao(o,i);return e$.result2(o,`${n}x${t}`,r)}))}function Go(o=""){return x(this,void 0,void 0,(function*(){const{size:t}=Ft(S(o)),n=t<10240?"small":t>=102400?"big":"middle",i=qo[n],r=yield Ao(o,i);return e$.result3(o,n,r)}))}export default function yo(t){return x(this,void 0,void 0,(function*(){io("group");const n=no(e$.doing).start();eo(ai.group),rs(ai.group);const{count:i,imgs:r}=pi(),e="boolean"==typeof t.type?"format":t.type,s=[];for(const o of r){const t=yield ko[e](o);s.push(t)}n.stop(),console.log(e$.stats(i)),s.length<=100&&s.forEach((o=>console.log(o))),console.log(e$.done),o(1)}))}