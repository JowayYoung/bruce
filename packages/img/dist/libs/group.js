var x=this&&this.__awaiter||function(o,t,n,i){return new(n||(n=Promise))((function(r,e){function s(o){try{p(i.next(o))}catch(o){e(o)}}function u(o){try{p(i.throw(o))}catch(o){e(o)}}function p(o){var t;o.done?r(o.value):(t=o.value,t instanceof n?t:new n((function(o){o(t)}))).then(s,u)}p((i=i.apply(o,t||[])).next())}))};import{createReadStream as Ko,createWriteStream as Mo,statSync as wt}from"node:fs";import{basename as _,join as qo}from"node:path";import{exit as s}from"node:process";import{AbsPath as S,AsyncTo as Y,CheckPath as qe,CreateDir as ns,RandomId as Oo,RemoveDir as eo,WaitFor as We}from"@yangzw/bruce-us/dist/node.js";import To from"image-size";import no from"ora";import{GROUP_TEXT as o$}from"../langs/index.js";import{OUTPUT_DIR as Qo,FilterImg as Vo,GetExt as Go,ShowTitle as io}from"../utils/index.js";const Uo={gif:qo(Qo.group,"gif"),jpg:qo(Qo.group,"jpg"),png:qo(Qo.group,"png"),svg:qo(Qo.group,"svg"),webp:qo(Qo.group,"webp")},Wo={format:Zo,size:Ct,volume:Et},Xo={big:qo(Qo.group,"big"),middle:qo(Qo.group,"middle"),small:qo(Qo.group,"small")};function Yo(){return x(this,arguments,void 0,(function*(o="",t=""){const n=new Promise((n=>{var i;const r=qo(t,_(o).toLowerCase()),e=S(r);if(ns(t),qe(r)){const t=_(e).split("."),r=null!==(i=t.pop())&&void 0!==i?i:"png",s=t.concat(Oo(4),r).join("."),u=e.replace(_(e),s);Ko(o).pipe(Mo(u)),n(!0)}else Ko(o).pipe(Mo(e)),n(!1)})),[i,r]=yield Y(n);return yield We(100),!i&&r}))}function Zo(){return x(this,arguments,void 0,(function*(o=""){const t=Go(o),n=Uo[t],i=yield Yo(o,n);return o$.result1(o,t,i)}))}function Ct(){return x(this,arguments,void 0,(function*(o=""){const{height:t=0,width:n=0}=To(o),i=qo(Qo.group,`${n}x${t}`),r=yield Yo(o,i);return o$.result2(o,`${n}x${t}`,r)}))}function Et(){return x(this,arguments,void 0,(function*(o=""){const{size:t}=wt(S(o)),n=t<10240?"small":t>=102400?"big":"middle",i=Xo[n],r=yield Yo(o,i);return o$.result3(o,n,r)}))}export default function zo(o){return x(this,void 0,void 0,(function*(){io("group");const t=no(o$.doing).start();eo(Qo.group),ns(Qo.group);const{count:n,imgs:i}=Vo(),r="boolean"==typeof o.type?"format":o.type,e=[];for(const o of i){const t=yield Wo[r](o);e.push(t)}t.stop(),console.log(o$.stats(n)),e.length<=100&&e.forEach((o=>console.log(o))),console.log(o$.done),s(1)}))}