var g=this&&this.__awaiter||function(o,t,e,n){return new(e||(e=Promise))((function(i,r){function s(o){try{u(n.next(o))}catch(o){r(o)}}function a(o){try{u(n.throw(o))}catch(o){r(o)}}function u(o){var t;o.done?i(o.value):(t=o.value,t instanceof e?t:new e((function(o){o(t)}))).then(s,a)}u((n=n.apply(o,t||[])).next())}))};import{createReadStream as uo,createWriteStream as go,statSync as Ct}from"fs";import{basename as w,join as Ze}from"path";import{exit as o}from"process";import{AbsPath as $,AsyncTo as M,CheckPath as Nt,CreateDir as ns,RandomId as ho,RemoveDir as ze,WaitFor as Fe}from"@yangzw/bruce-us/dist/node.js";import vo from"image-size";import Je from"ora";import{GROUP_TEXT as Ve}from"../langs/index.js";import{OUTPUT_DIR as ai,FilterImg as mi,GetExt as pi,ShowTitle as De}from"../utils/index.js";const yo={gif:Ze(ai.group,"gif"),jpg:Ze(ai.group,"jpg"),png:Ze(ai.group,"png"),svg:Ze(ai.group,"svg"),webp:Ze(ai.group,"webp")},wo={format:jo,size:Po,volume:To},bo={big:Ze(ai.group,"big"),middle:Ze(ai.group,"middle"),small:Ze(ai.group,"small")};function xo(o="",t=""){return g(this,void 0,void 0,(function*(){const e=new Promise((e=>{var n;const i=Ze(t,w(o).toLowerCase()),r=$(i);if(ns(t),Nt(i)){const t=w(r).split("."),i=null!==(n=t.pop())&&void 0!==n?n:"png",s=t.concat(ho(4),i).join("."),a=r.replace(w(r),s);uo(o).pipe(go(a)),e(!0)}else uo(o).pipe(go(r)),e(!1)})),[n,i]=yield M(e);return yield Fe(100),!n&&i}))}function jo(o=""){return g(this,void 0,void 0,(function*(){const t=pi(o),e=yo[t],n=yield xo(o,e);return Ve.result1(o,t,n)}))}function Po(o=""){return g(this,void 0,void 0,(function*(){const{height:t=0,width:e=0}=vo(o),n=Ze(ai.group,`${e}x${t}`),i=yield xo(o,n);return Ve.result2(o,`${e}x${t}`,i)}))}function To(o=""){return g(this,void 0,void 0,(function*(){const{size:t}=Ct($(o)),e=t<10240?"small":t>=102400?"big":"middle",n=bo[e],i=yield xo(o,n);return Ve.result3(o,e,i)}))}export default function mo(t){return g(this,void 0,void 0,(function*(){De("group");const e=Je(Ve.doing).start();ze(ai.group),ns(ai.group);const{count:n,imgs:i}=mi(),r="boolean"==typeof t.type?"format":t.type,s=[];for(const o of i){const t=yield wo[r](o);s.push(t)}e.stop(),console.log(Ve.stats(n)),s.length<=100&&s.forEach((o=>console.log(o))),console.log(Ve.done),o(1)}))}