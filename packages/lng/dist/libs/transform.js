var x=this&&this.__awaiter||function(n,t,e,o){return new(e||(e=Promise))((function(i,r){function s(n){try{u(o.next(n))}catch(n){r(n)}}function a(n){try{u(o.throw(n))}catch(n){r(n)}}function u(n){var t;n.done?i(n.value):(t=n.value,t instanceof e?t:new e((function(n){n(t)}))).then(s,a)}u((o=o.apply(n,t||[])).next())}))};import{writeFileSync as st}from"node:fs";import{exit as s}from"node:process";import{AbsPath as S,CheckPath as qe,RemoveDir as eo}from"@yangzw/bruce-us/dist/node.js";import Oo from"exceljs";import no from"ora";import me from"voca";import{TRANSFORM_TEXT as n$}from"../langs/index.js";import{ShowTitle as io}from"../utils/index.js";export default function Co(){return x(this,void 0,void 0,(function*(){io("transform"),qe("i18n.xlsx")||(console.log(n$.judgeModules),s(1));const n=no(n$.doing).start(),t=new Oo.Workbook,e=[];let o="";yield t.xlsx.readFile(S("i18n.xlsx")),t.eachSheet(((n,t)=>{const i={},r=`./${n.name}.json`;let s=[],a="";n.eachRow(((r,u)=>{const c=r.values.filter(Boolean);if(1===u)s=c.slice(1),1===t&&(o+=s.reduce(((n,t,e,o)=>n+=0===e?`type LangEnum = ${JSON.stringify(t)}`:` | ${JSON.stringify(t)}${e===o.length-1?";":""}`),""),e.push("LangEnum"));else{const t=c[0],o=`${me.capitalize(n.name)}TextEnum`;i[t]=c.slice(1).reduce(((n,t,e)=>(n[s[e]]=t,n)),{}),a+=2===u?`\ntype ${me.capitalize(n.name)}TextEnum = ${JSON.stringify(t)}${2===n.actualRowCount?";":""}`:` | ${JSON.stringify(t)}${n.actualRowCount===u?";":""}`,!e.includes(o)&&e.push(o)}})),o+=a,eo(r),st(S(r),JSON.stringify(i,null,"\t"),"utf8")})),e.push("LangType"),o+="\ntype LangType = Record<LangEnum, string>;",o+=e.filter((n=>!n.startsWith("Lang"))).reduce(((n,t)=>{const o=t.replace("Enum","Type");return n+=`\ntype ${o} = Record<${t}, LangType>;`,e.push(o),n}),""),o+=`\n\nexport {${e.reduce(((n,t,e,o)=>n+=`\n\t${t}${e<o.length-1?",":""}`),"")}\n};`,eo("i18n.d.ts"),st(S("i18n.d.ts"),o,"utf8"),n.stop(),console.log(n$.done),s(1)}))}