import{existsSync as nr,readdirSync as cr,readFileSync as ar,statSync as dr}from"fs";import{dirname as w,extname as s,join as gr}from"path";import{cwd as hr,stdout as wr}from"process";import{fileURLToPath as B}from"url";import{promisify as yr}from"util";import{AsyncTo as br,IsFunction as ue,IsObject as $r,NodeType as o,WaitFor as vr}from"@yangzw/bruce-us/dist/node.js";import ge from"chalk";import{watch as kr}from"chokidar";import Pr from"latest-version";import N from"webpack";import xr from"yaml";import{ACTION_TEXT as F}from"../i18n/index.js";import{REGEXP as ze}from"./getting.js";function E(r="",t=hr()){return gr(t,r)}async function ot(r=""){(0,(await import(`../../scripts/bin/${r}.js`)).default)()}async function rt(r={}){const t=yr(N),o=await t(r),n=new Promise(((r,t)=>{wr.write(o.toString({children:!1,chunkModules:!1,chunks:!1,colors:!0,modules:!1})+"\n\n"),o.hasErrors()?t(!1):r(!0)}));return br(n)}async function it(r=[]){return r.reduce((async(r,t)=>{const o=await r,n=t.includes("vue")?await Pr(t,{version:"next"}):await Pr(t);return o[t]=n,o}),Promise.resolve({}))}function tt(r="",t=hr()){return nr(E(r,t))}function i(r="",t="entryFile"){if(!tt(r))return"";const o=cr(E(r)).filter((o=>dr(E(`${r}/${o}`)).isFile()&&ze[t].test(o)))[0]||"";return o?E(`${r}/${o}`):""}function u(r="",t=hr()){const o=E(r,t),n=s(o);if(!/^\.yml$/.test(n))return{};const e=ar(o,"utf8");return xr.parse(e)}function mt(r="green",t=""){console.log(ge[`${r}Bright`](t))}function et(r=""){console.log(`##### ${F[r]} #####`)}async function gt({mode:r="prod",opts:t=null,path:o=""}={}){await vr(3e3);const n=ue(t)?t(r):$r(t)?t:null;if(!n||!o)return!1;const{host:e="",password:s="",port:i=9999,privateKey:c="",remotePath:u="",username:a=""}=n,m=Object.assign({host:e,port:i,username:a},c?{privateKey:c}:{password:s});console.log("上传文件的功能正在开发中",{...m,remotePath:u})}function pt(r=null){if("windows"===o().system)return;const t=w(B(import.meta.url));kr([E("../..",t),E("brucerc.js"),E("brucerc.json"),E("brucerc.yml"),E("tsconfig.json"),E("src/global.d.ts")]).on("change",(t=>{const o=t.replace(/\\/g,"/").split("/").pop();r&&r(o)}))}export{E as AbsPath,ot as AutoBin,rt as BuildApp,it as GetDepVers,tt as IsPath,i as JudgeFile,u as ReadYml,mt as ShowMsg,et as ShowTitle,gt as UploadFiles,pt as WatchFiles};