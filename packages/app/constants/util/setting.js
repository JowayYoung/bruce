import{existsSync as nr,readdirSync as cr,readFileSync as ur,statSync as ar}from"fs";import{dirname as g,extname as s,join as lr}from"path";import{cwd as pr,stdout as fr}from"process";import{fileURLToPath as h}from"url";import{promisify as dr}from"util";import{AsyncTo as gr,IsFunction as ue,IsObject as hr,NodeType as o,WaitFor as wr}from"@yangzw/bruce-us/dist/node.js";import ge from"chalk";import{watch as yr}from"chokidar";import br from"latest-version";import N from"webpack";import jr from"yaml";import{ACTION_TEXT as D}from"../i18n/index.js";import{REGEXP as ze}from"./getting.js";function w(r="",t=pr()){return lr(t,r)}async function tt(r=""){(0,(await import(`../../scripts/bin/${r}.js`)).default)()}async function ot(r={}){const t=dr(N),o=await t(r),n=new Promise(((r,t)=>{fr.write(o.toString({children:!1,chunkModules:!1,chunks:!1,colors:!0,modules:!1})+"\n\n"),o.hasErrors()?t(!1):r(!0)}));return gr(n)}async function rt(r=[]){return r.reduce((async(r,t)=>{const o=await r,n=t.includes("vue")?await br(t,{version:"next"}):await br(t);return o[t]=n,o}),Promise.resolve({}))}function X(r="",t=pr()){return nr(w(r,t))}function i(r="",t="entryFile"){if(!X(r))return"";const o=cr(w(r)).filter((o=>ar(w(`${r}/${o}`)).isFile()&&ze[t].test(o)))[0]||"";return o?w(`${r}/${o}`):""}function u(r="",t=pr()){const o=w(r,t),n=s(o);if(!/^\.yml$/.test(n))return{};const e=ur(o,"utf8");return jr.parse(e)}function it(r="green",t=""){console.log(ge[`${r}Bright`](t))}function mt(r=""){console.log(`##### ${D[r]} #####`)}async function et({mode:r="prod",opts:t=null,path:o=""}={}){await wr(3e3);const n=ue(t)?t(r):hr(t)?t:null;if(!n||!o)return!1;const{host:e="",password:s="",port:i=9999,privateKey:c="",remotePath:u="",username:a=""}=n,m=Object.assign({host:e,port:i,username:a},c?{privateKey:c}:{password:s});console.log("上传文件的功能正在开发中",{...m,remotePath:u})}function gt(r=null){if("windows"===o().system)return;const t=g(h(import.meta.url));yr([w("../..",t),w("brucerc.js"),w("brucerc.json"),w("brucerc.yml"),w("tsconfig.json"),w("src/global.d.ts")]).on("change",(t=>{const o=t.replace(/\\/g,"/").split("/").pop();r&&r(o)}))}export{w as AbsPath,tt as AutoBin,ot as BuildApp,rt as GetDepVers,X as IsPath,i as JudgeFile,u as ReadYml,it as ShowMsg,mt as ShowTitle,et as UploadFiles,gt as WatchFiles};