import{IsFunction as ue,IsString as pe}from"@yangzw/bruce-us/dist/node.js";import{merge as ie}from"webpack-merge";import{BROWSERS_ES6 as fe}from"../../constants/util/index.js";import{ProdEntry as m}from"../entry/index.js";import{ProdOptimizer as z}from"../optimizer/index.js";import{ProdOutput as A}from"../output/index.js";import{BarPlugin as D,BuildNotifierPlugin as G,BundleAnalyzerPlugin as J,CompressionPlugin as K,DefinePlugin as V,EslintPlugin as M,HtmlPlugin as X,HtmlTagsPlugin as st,MiniCssExtractPlugin as q,StylelintPlugin as ir,TinyimgPlugin as mr,VuePlugin as or}from"../plugin/index.js";import{CssRule as de,FontRule as te,ImgRule as ae,JsRule as sr,LessRule as er,MdRule as tr,MediaRule as fr,RawRule as jr,ScssRule as lr,SvgRule as pr,VueRule as ur}from"../rule/index.js";import me from"./base-webpack.js";export default function oo(e={}){const{alias:s,browsers:r,eslintIgnores:o,eslintRules:t,frame:i,mode:l,polyfill:n,publicPath:u,scriptAssets:a,style:p,styleAssets:d,stylelintIgnores:f,stylelintRules:b,useAnalyzer:c,useCompressor:y,useCsslint:j,useHash:g,useImageminer:x,useJslint:w,useOutput:h,useTimer:T,useTs:H}=e,I=h?r:fe,k=ue(u)?u(l):pe(u)?u:"";return ie(me(s),{devtool:"prod"!==l&&"source-map",entry:m(),mode:"production",module:{rules:[de({browsers:I}),lr({browsers:I}),er({browsers:I}),sr({browsers:I,frame:i,mode:n,useTs:H}),ae(),te(),tr(),fr(),jr(),pr(),ur()]},optimization:z({mode:l}),output:A({mode:l,publicPath:k,useHash:g,useTimer:T}),performance:{assetFilter:e=>"vendor.bundle.js"!==e&&!/\.map$/.test(e),maxAssetSize:512e3,maxEntrypointSize:1024e3},plugins:[V({mode:l}),D(),G(),J({disabled:!c}),K({disabled:!y}),M({disabled:!w,frame:i,ignores:o,rules:t,useTs:H}),X(),st({scripts:["dynamic"===n&&"https://polyfill.alicdn.com/polyfill.min.js",...a].filter(Boolean),styles:d}),q({useHash:g}),ir({disabled:!j,frame:i,ignores:f,rules:b,style:p}),mr({disabled:!x}),or()].filter(Boolean)})}